SELECT 
    pm.project_name,
    mm.module_name,
    tm.task_name,
    mm.from_date AS module_start_date,
    mm.to_date AS module_end_date,
    TIMESTAMPDIFF(DAY, mm.from_date, mm.to_date) AS allocated_time_in_days,
    pm.stage
FROM 
    project_master pm
JOIN 
    module_master mm ON pm.project_id = mm.project_id
JOIN 
    task_master tm ON mm.task_id = tm.task_id
WHERE 
    pm.stage IN ('inprocess', 'rfp', 'won')
ORDER BY 
    pm.project_name,
    pm.stage;
